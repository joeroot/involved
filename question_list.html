
<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>Foundation 4</title>
  <script src="http://js.pusher.com/2.1/pusher.min.js" type="text/javascript"></script>

  <link rel="stylesheet" href="css/foundation.css" />
  <link rel="stylesheet" href="css/main.css" />

  <script type="text/javascript" src="//use.typekit.net/xuo4ojj.js"></script>
  <script src="http://www.parsecdn.com/js/parse-1.2.8.min.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script src="js/vendor/custom.modernizr.js"></script>
  <script src="js/main.js"></script>
</head>

<body>

  <header>
    <div class="row">
      <div class="large-12 columns text-center">
        <h2>Involved</h2>
      </div>
    </div>
  </header>

  <div class="row question extramargin">
    <div class="large-8 large-centered columns text-center">
      <h6>QUESTION ADMIN:</h6>
      <h3>Set a question or see results</h3>
    </div>
  </div>


<div class="row archive results">
  <div id="questions" class="columns large-8 large-offset-2">
    <div id="question-template" class="row question hidden">
      <div class="columns large-8">
        <h4 style="float:left">Do you love me?</h4>
      </div>
      <div class="columns large-4">
        <button class="button success ask">Ask</button>
        <button class="button alert stop">Stop</button>
        <button class="button alert">Results</button>
      </div>
    </div>
  </div>
</div>


  <script>
    document.write('<script src=' +
                   ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
                   '.js><\/script>')
  </script>

  <script src="js/foundation.min.js"></script>
  <!--

  <script src="js/foundation/foundation.js"></script>

  <script src="js/foundation/foundation.alerts.js"></script>

  <script src="js/foundation/foundation.clearing.js"></script>

  <script src="js/foundation/foundation.cookie.js"></script>

  <script src="js/foundation/foundation.dropdown.js"></script>

  <script src="js/foundation/foundation.forms.js"></script>

  <script src="js/foundation/foundation.joyride.js"></script>

  <script src="js/foundation/foundation.magellan.js"></script>

  <script src="js/foundation/foundation.orbit.js"></script>

  <script src="js/foundation/foundation.reveal.js"></script>

  <script src="js/foundation/foundation.section.js"></script>

  <script src="js/foundation/foundation.tooltips.js"></script>

  <script src="js/foundation/foundation.topbar.js"></script>

  <script src="js/foundation/foundation.interchange.js"></script>

  <script src="js/foundation/foundation.placeholder.js"></script>

  -->
<script>
  var pusher = new Pusher('7638841659acb7e9cdfd', { authEndpoint: 'http://pacific-fjord-7492.herokuapp.com/auth', authTransport: 'jsonp' });
  var slug = getURLParameter('slug');
  var channel = pusher.subscribe('private-'+slug);
  Parse.initialize("EeEFArcfnsV0d1uVCJ4K5j6y86se3cyKP5bEigcm", "TuWtuZ7iXYxkxOar3vwlVFq2jOpkHTPRilxSjllC");
  function addQuestion(question, questionId, slug) {
      var template = $('#question-template').clone();
      $(template).attr('id','question-'+questionId);
      template.find('.ask').data('id', questionId);
      template.find('.stop').data('id', questionId);
      $(template).removeClass('hidden');
      $(template).find('h4').text(question);
      $('#questions').append(template);
  }

  $('#questions').on('click','.ask', function(){
    var qid = $(this).data('id')
      var triggered = channel.trigger('client-'+slug, { "question_id": qid, "action": "start" });

  });
  $('#questions').on('click','.stop', function(){
    var qid = $(this).data('id')
    var triggered = channel.trigger('client-'+slug, { "question_id": qid, "action": "stop" });

  });
  function getInformation(slug) {
      if (slug == 'null') {
        alert('No quiz ID provided in URL');
        return;
      }
      var Quiz = Parse.Object.extend("Quiz");
      var Question = Parse.Object.extend("Question");
      var query = new Parse.Query(Quiz);
      query.equalTo('slug', slug);
      query.find({
      success: function(quiz) {
        query = new Parse.Query(Question);
        query.equalTo("quiz",quiz[0]);
        query.find({
            success: function(questions) {

              for (var i = 0; i < questions.length; i++) {
                var question = questions[i];
                addQuestion(question.get('question'), question.id);
              }
            },
            error: function(obj, error){
              console.log(obj)

            }
        });
      },
      error: function(object, error) {
        console.log(error)
      }
    });
  }

    $(document).foundation();

    getInformation(slug);

  </script>
</body>
</html>
