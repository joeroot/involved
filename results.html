<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>Foundation 4</title>

  <link rel="stylesheet" href="css/foundation.css" />
  <link rel="stylesheet" href="css/main.css" />

  <script type="text/javascript" src="//use.typekit.net/xuo4ojj.js"></script>
  <script src="http://www.parsecdn.com/js/parse-1.2.8.min.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script src="js/vendor/custom.modernizr.js"></script>
  <script src="js/main.js"></script>
</head>

<body>

  <header>
    <div class="row">
      <div class="large-12 columns text-center">
       <h2><a href="/"><img src="img/logo.png" alt="logo" style="height:25px;margin-top:-5px" /> Involved</a></h2>
      </div>
    </div>
  </header>

  <div class="row question">
    <div class="large-8 large-centered columns text-center">
      <h6>Question:</h6>
      <h3 id="question-text"></h3>
    </div>
  </div>


<div class="row results">
  <div class="columns large-8 large-offset-2">
  <div id="answer-template" class="hidden">
    <div id="answer" class="answer row panel answer">
      <div class="large-4 columns text-center"><h4><span class="answer-value">Absolutely</span> - <span class="answer-percent">0</span></h4></div>
      <div class="large-8 columns">
        <div class="progress"><span class="meter secondary" style="width:0%"></span></div>
      </div>
    </div>
    </div>
  </div>
</div>







  <script>
    document.write('<script src=' +
                   ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') +
                   '.js><\/script>')
  </script>

  <script src="js/foundation.min.js"></script>
  <!--

  <script src="js/foundation/foundation.js"></script>

  <script src="js/foundation/foundation.alerts.js"></script>

  <script src="js/foundation/foundation.clearing.js"></script>

  <script src="js/foundation/foundation.cookie.js"></script>

  <script src="js/foundation/foundation.dropdown.js"></script>

  <script src="js/foundation/foundation.forms.js"></script>

  <script src="js/foundation/foundation.joyride.js"></script>

  <script src="js/foundation/foundation.magellan.js"></script>

  <script src="js/foundation/foundation.orbit.js"></script>

  <script src="js/foundation/foundation.reveal.js"></script>

  <script src="js/foundation/foundation.section.js"></script>

  <script src="js/foundation/foundation.tooltips.js"></script>

  <script src="js/foundation/foundation.topbar.js"></script>

  <script src="js/foundation/foundation.interchange.js"></script>

  <script src="js/foundation/foundation.placeholder.js"></script>

  -->

  <script>

  function addAnswer(answer, text, correct) {
      var template = $('#answer-template').clone();
      $(template).find('.answer-value').text(text);
      if (correct) {
        $(template).children('#answer').addClass('callout');
      }
      $(template).children('div').attr("id","answer-"+answer);
      $('.results').children('div').append(template.html());
  }

  function setScore(answer, score) {
      var answerfield = $('#answer-'+answer);
      answerfield.find(".answer-percent").text(score+"%");
      answerfield.find(".progress").children('span').attr("style", "width:"+score+"%");
  }

  function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
     vars[key] = value;
    });
    return vars;
  }

  var questionId = getUrlVars()["questionId"];

  function getInformation(questionId) {
      var Question = Parse.Object.extend("Question");
      var Answer = Parse.Object.extend("Answer");
      var query = new Parse.Query(Question);
      query.get(questionId, {
      success: function(question) {
        $('#question-text').text(question.get('question'));
        query = new Parse.Query(Answer);
        query.ascending("createdAt");
        query.equalTo("parent", question);
        query.find({
            success: function(answers) {
              $("[id^=answer-].answer").remove();
              var totalVotes = 0;
              for (var i = 0; i < answers.length; i++) {
                totalVotes += parseInt(answers[i].get('votes'));
              }
              for (var i = 0; i < answers.length; i++) {
                var answer = answers[i];
                var chr = String.fromCharCode(97 + i);
                addAnswer(chr, answer.get('answer'), answer.get('correct'));
                var percentage = (parseInt(answer.get('votes'))/totalVotes)*100;
                setScore(chr,percentage);
              }
            }
          });
      },
      error: function(object, error) {
        // The object was not retrieved successfully.
        // error is a Parse.Error with an error code and description.
      }
    });
  }

    $(document).foundation();
    Parse.initialize("EeEFArcfnsV0d1uVCJ4K5j6y86se3cyKP5bEigcm", "TuWtuZ7iXYxkxOar3vwlVFq2jOpkHTPRilxSjllC");

    var quizId = getURLParameter('quidId');
    var questionId = getURLParameter('questionId');
    getInformation(questionId);

    window.setInterval(function() {
      getInformation(questionId);
    },4000);

  </script>
</body>
</html>
