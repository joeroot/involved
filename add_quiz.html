<!DOCTYPE html>
<!--[if IE 8]> 				 <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>Create Quiz - Involved</title>

  <link rel="stylesheet" href="css/foundation.css" />
  <link rel="stylesheet" href="css/main.css" />

  <script type="text/javascript" src="//use.typekit.net/xuo4ojj.js"></script>
  <script src="http://www.parsecdn.com/js/parse-1.2.8.min.js"></script>
  <script type="text/javascript">try{Typekit.load();}catch(e){}</script>
  <script src="js/vendor/custom.modernizr.js"></script>

  <link href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.min.css" rel="stylesheet">

</head>

<body>

  <header>
    <div class="row">
      <div class="large-12 columns text-center">
        <a href="/"><h2>Involved</h2></a>
      </div>
    </div>
  </header>

  <div class="large-8 columns large-centered large-offset-2">


  <form>
    <h3>Create your quiz</h3>

    Reference Code:<input type="text" class="ref" id="reference_code" placeholder="reference code"/>
    <div class="row" id="questions-container">
      <div class="question_template">
        <fieldset>
          <legend>Question</legend>

            <div class="question row">
              <div class="large-2 columns"><label><h5>Question</h5></label></div>
              <div class="large-8 columns"><input id="quiz_question" type="text" placeholder="Question"></div>
              <div class="large-2 columns"></div>
            </div>

            <div id="answers-container">
              <div class="answer-template">
                <div class="row answer-field">
                  <div class="large-12 columns">

                    <div class="row">
                      <div class="large-2 columns"><label><h5>Answer</h5></label></div>
                      <div class="large-1 columns"><input type="radio" class="correct" id="correct-answer" /></div>
                      <div class="large-6 columns"><input type="text" class='an-answer' placeholder="Enter a possible answer"></div>
                      <button href="#" class="button admin" id="remove-answer">-</button>
                      <button href="#" class="button admin" id="add-answer">+</button>
                    </div>

                  </div>
                </div>
              </div> 
            </div>
          </legend>
        </fieldset>
      </div>
    </div>
      <button href="#" class="button admin" id="add-question">Add Question</button>
        <div class="row">
          <div class="columns large-12 large-centered text-center">
          <button id="save-quiz" class="button admin">Save Quiz</button>
        </div>
      </div>
    </form>
  </div>

  <script>
  document.write('<script src=' + ('__proto__' in {} ? 'js/vendor/zepto' : 'js/vendor/jquery') + '.js><\/script>')
  </script>

  <script src="js/foundation.min.js"></script>

  <script>
    $(document).foundation();
    Parse.initialize("EeEFArcfnsV0d1uVCJ4K5j6y86se3cyKP5bEigcm", "TuWtuZ7iXYxkxOar3vwlVFq2jOpkHTPRilxSjllC");
    //var TestObject = Parse.Object.extend("TestObject");
    //var testObject = new TestObject();

    $('#add-answer').click(function() {
      event.preventDefault();
      $('#answers-container').append($('.answer-template').html());
    });

    $('#remove-answer').click(function() {
      event.preventDefault();
      $('#answers-container').remove($('.answer-template').html());
    });

    $('#add-question').click(function() {
      event.preventDefault();
      $('#questions-container').append($('.question-template').html());
    });
    

    var Quiz = Parse.Object.extend("Quiz");
    var Question = Parse.Object.extend("Question");
    var Answer = Parse.Object.extend("Answer");


    $('#save-quiz').click(function(event){
      event.preventDefault();
      console.log('hoping to save quiz')

      var quiz = new Quiz();
      //save each question
      var questions = $('#quiz-question').each(function(q_index,q_item) {
        console.log('iterating through questions')
        var question = new Question();
        var questionString = $(q_item).val();
        //add each answer
        $('.answer-field .an-answer').each(function(a_index,a_item) {
            console.log('iterating answers')
            var answer = new Answer;
            var answerString = $(a_item).val();
            answer.save({
              answer: answerString,
              votes: '0',
              correct: false,
              parent: question,
            })
        });

        question.save({
          question: questionString,
          quiz: quiz,
        });
      });
      quiz.save({
        ref: 214,
      }, {  
        success: function(quiz) {
        console.log('Quiz saved apparently. Quiz id:' + quiz.id)
      },
        error: function(quiz, error) {
        // The save failed.
        // error is a Parse.Error with an error code and description.
        }
      });
    });

  </script>
</body>
</html>
